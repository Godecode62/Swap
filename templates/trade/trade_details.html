{% extends 'base.html' %}
{% load static %}

{% block title %}Détails de l'échange{% endblock %}

{% block content %}
<div class="relative min-h-screen py-16 px-4 bg-gray-950 overflow-hidden font-sans text-gray-200">
    <div class="absolute inset-0 bg-radial-gradient-t from-gray-800 to-gray-950 opacity-50"></div>
    <div class="absolute inset-0 z-0 opacity-20">
        <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%">
            <defs>
                <pattern id="grid" width="32" height="32" patternUnits="userSpaceOnUse">
                    <path d="M 16 0 L 16 32 M 0 16 L 32 16" fill="none" stroke="rgba(255, 255,255, 0.05)" stroke-width="1"></path>
                </pattern>
            </defs>
            <rect width="100%" height="100%" fill="url(#grid)"></rect>
        </svg>
    </div>
    
    <div class="w-full max-w-7xl mx-auto p-6 relative z-10">
        <div class="flex items-center space-x-4 mb-8">
            <a href="{% url 'my_trades' %}" class="bg-gray-800 hover:bg-gray-700 text-white p-3 rounded-full transition-colors duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                </svg>
            </a>
            <h1 class="text-4xl font-extrabold text-white bg-clip-text text-transparent bg-gradient-to-r from-teal-400 to-cyan-500">
                Détails de l'échange
            </h1>
        </div>

        <div class="bg-gray-900 rounded-3xl shadow-2xl backdrop-blur-xl border border-gray-700 p-8">
            
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 pb-4 border-b border-gray-700">
                <div>
                    <p class="text-lg text-gray-400">Offre initiée le {{ trade_offer.created_at|date:"d M Y" }}</p>
                </div>
                <span class="mt-4 md:mt-0 px-4 py-2 rounded-full text-sm font-bold {% if trade_offer.status == 'pending' %}bg-yellow-800 text-yellow-300{% elif trade_offer.status == 'accepted' %}bg-green-800 text-green-300{% else %}bg-red-800 text-red-300{% endif %}">
                    {{ trade_offer.get_status_display }}
                </span>
            </div>

            <div class="flex flex-col md:flex-row justify-center items-center gap-8 mb-8">
                <div class="w-full md:w-1/2 p-6 bg-gray-800 rounded-2xl border border-gray-700 transition-all duration-300 hover:shadow-lg hover:border-cyan-500">
                    <h2 class="text-2xl font-bold text-gray-300 mb-4 text-center">Offert par <a href="{% url 'public_profile' trade_offer.offered_by.pk %}" class="text-cyan-400 hover:underline">@{{ trade_offer.offered_by.username }}</a></h2>
                    <div class="flex flex-col items-center">
                        <a href="{% url 'item_detail' trade_offer.item_offered.pk %}" class="group">
                            <img src="{{ trade_offer.item_offered.photo.url }}" alt="{{ trade_offer.item_offered.title }}" class="w-40 h-40 object-cover rounded-3xl ring-4 ring-cyan-500 shadow-xl mb-4 transition-transform duration-300 group-hover:scale-105">
                        </a>
                        <h3 class="text-xl font-bold text-white">{{ trade_offer.item_offered.title }}</h3>
                        <p class="text-gray-400 mt-1 text-center">{{ trade_offer.item_offered.description|truncatechars:100 }}</p>
                    </div>
                </div>

                <div class="flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-20 w-20 text-gray-600 rotate-90 md:rotate-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M8 7l4-4 4 4M16 17l-4 4-4-4"></path>
                        <path d="M12 3v18"></path>
                    </svg>
                </div>
                
                <div class="w-full md:w-1/2 p-6 bg-gray-800 rounded-2xl border border-gray-700 transition-all duration-300 hover:shadow-lg hover:border-purple-500">
                    <h2 class="text-2xl font-bold text-gray-300 mb-4 text-center">Demandé par <a href="{% url 'public_profile' trade_offer.item_requested.owner.pk %}" class="text-purple-400 hover:underline">@{{ trade_offer.item_requested.owner.username }}</a></h2>
                    <div class="flex flex-col items-center">
                        <a href="{% url 'item_detail' trade_offer.item_requested.pk %}" class="group">
                            <img src="{{ trade_offer.item_requested.photo.url }}" alt="{{ trade_offer.item_requested.title }}" class="w-40 h-40 object-cover rounded-3xl ring-4 ring-purple-500 shadow-xl mb-4 transition-transform duration-300 group-hover:scale-105">
                        </a>
                        <h3 class="text-xl font-bold text-white">{{ trade_offer.item_requested.title }}</h3>
                        <p class="text-gray-400 mt-1 text-center">{{ trade_offer.item_requested.description|truncatechars:100 }}</p>
                    </div>
                </div>
            </div>

            <div class="mt-8 pt-4 border-t border-gray-700">
                <h2 class="text-2xl font-bold text-gray-300 mb-4 text-center">Actions</h2>
                
                {% if trade_offer.status == 'pending' %}
                    <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 justify-center">
                        {% if request.user == trade_offer.item_requested.owner %}
                            <form method="post" action="{% url 'trade_details' trade_offer.pk %}" class="w-full md:w-1/3">
                                {% csrf_token %}
                                <input type="hidden" name="action" value="accept">
                                <button type="submit" class="w-full bg-gradient-to-r from-green-500 to-lime-600 hover:from-green-600 hover:to-lime-700 text-white font-bold py-3 px-6 rounded-full transition duration-300 transform hover:scale-105 shadow-xl">
                                    Accepter le troc
                                </button>
                            </form>
                            <form method="post" action="{% url 'trade_details' trade_offer.pk %}" class="w-full md:w-1/3">
                                {% csrf_token %}
                                <input type="hidden" name="action" value="reject">
                                <button type="submit" class="w-full bg-gradient-to-r from-red-500 to-pink-600 hover:from-red-600 hover:to-pink-700 text-white font-bold py-3 px-6 rounded-full transition duration-300 transform hover:scale-105 shadow-xl">
                                    Refuser le troc
                                </button>
                            </form>
                        {% elif request.user == trade_offer.offered_by %}
                            <form method="post" action="{% url 'trade_details' trade_offer.pk %}" class="w-full md:w-1/3 mx-auto">
                                {% csrf_token %}
                                <input type="hidden" name="action" value="cancel">
                                <button type="submit" class="w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-full transition duration-300 transform hover:scale-105 shadow-xl">
                                    Annuler mon offre
                                </button>
                            </form>
                        {% endif %}
                    </div>
                {% else %}
                    <p class="text-center text-gray-500 text-lg">
                        Cette offre a déjà été <span class="font-bold text-white">{{ trade_offer.get_status_display }}</span>. Aucune action n'est possible.
                    </p>
                {% endif %}
            </div>
            
        </div>
    </div>
</div>
{% endblock %}